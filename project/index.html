<!DOCTYPE html>
<html>
<head>
  <title>DNN 預測網頁</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0/dist/tf.min.js"></script>
</head>
<body>
  <h2>電網負載預測器</h2>
  <label>Charging Sessions: <input type="number" id="charging_sessions" value="20"></label><br>
  <label>Charging Energy: <input type="number" id="charging_energy" value="45"></label><br>
  <label>Temperature: <input type="number" id="temperature" value="28"></label><br>
  <label>Total Power Demand: <input type="number" id="total_power_demand" value="150"></label><br>
  <label>Is Holiday (0 or 1): <input type="number" id="is_holiday" value="1"></label><br><br>
  
  <button onclick="predict()">預測</button>

  <h3 id="result">預測結果會顯示在這裡</h3>

  <script>
    let model;
    const mean = [ 19.79614517,  44.19196744,  26.65737986, 133.02333162,   0.46      ]
    const scale = [ 4.64336744, 12.20364055,  3.96621502, 17.70600087,  0.49839743];
    async function loadModel() {
      model = await tf.loadLayersModel('./tfjs_model/model.json');
      console.log("模型已載入");
    }

    function standardize(values) {
      return values.map((v, i) => (v - mean[i]) / scale[i]);
    }

    async function predict() {
      const input = [
        parseFloat(document.getElementById('charging_sessions').value),
        parseFloat(document.getElementById('charging_energy').value),
        parseFloat(document.getElementById('temperature').value),
        parseFloat(document.getElementById('total_power_demand').value),
        parseFloat(document.getElementById('is_holiday').value)
      ];

      const scaled = standardize(input);
      const inputTensor = tf.tensor2d([scaled]);

      const prediction = model.predict(inputTensor);
      const value = await prediction.data();

      document.getElementById("result").innerText = 
        `預測的電網負載（MW）：${value[0].toFixed(2)}`;
    }

    loadModel();
  </script>
</body>
</html>
